% test script for ideal detector position
% on grid image
% 2D

addpath(genpath('../'));

detector = load('../system/detectorframe/detectorpos_ideal_1000.mat');

detector = everything2single(detector);

focalspot = [0, -detector.SSD, 0];

object.index = 1;
object.type = 'image2D';
object.O = [0, 0, 0];
object.vector = eye(3);
object.volume = 1;

% object.index = 1;
% object.type = 'cylinder';
% object.O = [150, 60, 0];
% object.vector = eye(3).*30;
% object.volume = det(object.vector)*pi*2;

object.invV = inv(object.vector);

% imagepath = 'D:\Taiying\Data\testdata\Lung\';
% dcmfiles = ls([imagepath, '*.DCM']);
% object.image = [imagepath, dcmfiles(300,:)];
% info = dicominfo(object.image);
% object.Cimage = single(dicomread(info));
% 
% object.Cimage = object.Cimage+1000;
% object.Cimage(object.Cimage<-1000) = 0;
% object.Cimage = object.Cimage./1000;

object.Cimage = zeros(512, 512);
object.Cimage(400:412, 256:266) = 1;   


object = everything2single(object);

Nview = 1440;
% Nview = 3;
viewangle = linspace(0, pi*2, Nview+1);
viewangle = viewangle(1:end-1);

tic;
[D, L] = intersection(focalspot, detector.position, object, 'views-ray', viewangle, 0);
toc

% tic;
% D = projectioninimage(focalspot, detector.position, object.Cimage, viewangle);
% toc
